<div class="mb-8">
    <span>Search through all resources provided by Call to Arms - Gates Of Hell.</span>
</div>

<div class="sticky top-0 bg-white z-10">
    <mat-form-field appearance="outline" class="w-full mt-4" subscriptSizing="dynamic" hintLabel="Type at least 3 characters">
        <mat-label>Filter by name</mat-label>
        <input matInput [(ngModel)]="search" type="text" />
        @if (search().length) {
            <button matSuffix (click)="search.set('')" class="p-2 mr-4 cursor-pointer rounded-full hover:bg-gray-100">
                <ng-icon name="tablerX"></ng-icon>
            </button>
        }
    </mat-form-field>
    <div class="flex justify-end mt-4">
        <mat-checkbox [checked]="showFavorites()" (change)="showFavorites.set($event.checked)">Show Favorites</mat-checkbox>
    </div>
</div>

<div class="my-4">
    <app-preview-image [resolveUrl]="resolvePreviewUrl"></app-preview-image>

    <mat-tree #tree [class]="viewData().length ? 'border border-gray-200 rounded-md' : ''" [dataSource]="viewData()" [childrenAccessor]="childrenAccessor">
        <mat-tree-node
                (mouseenter)="openPreview(nodeElement, node)"
                (mouseleave)="closePreview()"
                (click)="copyName(node.name)"
                class="group w-full hover:font-semibold! flex gap-2 items-center cursor-pointer p-4 border-b border-b-gray-200 hover:bg-gray-100 last:border-b-0"
                *matTreeNodeDef="let node"
                matTreeNodePadding
                matTreeNodeToggle
                #nodeElement>
            <button
                    type="button"
                    class="px-2 opacity-70 hover:opacity-100 flex items-center"
                    (click)="toggleFavorite(node); $event.stopPropagation()"
                    [attr.aria-pressed]="isFavorite(node) ? 'true' : 'false'"
                    title="Toggle favorite"
            >
                <ng-icon [name]="isFavorite(node) ? 'tablerStarFill' : 'tablerStar'"></ng-icon>
            </button>

            <ng-icon name="tablerBox"></ng-icon>
            <span [innerHTML]="getText(node.name)" class="flex-1"></span>
            <ng-icon name="tablerCopy" class="hidden! group-hover:inline-block! transition-all"></ng-icon>
        </mat-tree-node>

        <mat-tree-node [attr.data-node]="tree.isExpanded(node) ? node.name : ''" class="tree-node w-full items-center cursor-pointer p-4 border-b border-b-gray-200 last:border-b-0 hover:bg-gray-100 transition-colors" *matTreeNodeDef="let node;when: hasChild" matTreeNodePadding matTreeNodeToggle>
            <button class="p-2 flex items-center" matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.name">
                <ng-icon [name]="tree.isExpanded(node) ? 'tablerFolderOpen' : 'tablerFolder'"></ng-icon>
            </button>
            <span [class.font-bold]="tree.isExpanded(node)" [innerHTML]="getText(node.name)" class="cursor-pointer">{{ node.name }}</span>
        </mat-tree-node>
    </mat-tree>

    @if (viewData().length === 0) {
        <div class="w-full flex justify-center mt-4">
            <span class="text-center text-black/50!">No resources found.</span>
        </div>
    }
</div>
