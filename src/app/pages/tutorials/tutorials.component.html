<div class="mx-auto max-w-6xl p-6 lg:p-10">

    <!-- Header -->
    <div class="flex flex-wrap items-start justify-between gap-4">
        <div>
            <h1 class="text-2xl font-semibold text-slate-900 dark:text-white">Tutorials</h1>
            <p class="mt-1 text-sm text-slate-600 dark:text-white/50">
                Browse all available editor tutorials.
            </p>
        </div>

        <div class="rounded-2xl bg-slate-50 dark:bg-white/5 px-4 py-3">
            <div class="text-xs text-slate-500 dark:text-white/50">Showing</div>
            <div class="mt-1 text-lg font-semibold text-slate-900 dark:text-white">
                {{ stats().shown }} <span
                    class="text-sm font-medium text-slate-500 dark:text-white/50">/ {{ stats().total }}</span>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="mt-4 grid grid-cols-1 gap-3 lg:grid-cols-[1fr_auto] items-center">
        <!-- Search -->
        <div class="rounded-2xl">
            <div class="flex items-center gap-3">
                <div class="w-full">
                    <label class="sr-only" for="tutorialSearch">Search tutorials</label>
                    <input
                            id="tutorialSearch"
                            type="text"
                            class="w-full p-4 my-2 dark:text-white outline-none rounded-2xl border border-slate-200 dark:border-white/25 placeholder:black/25"
                            placeholder="Search by title, tag, or group…"
                            [value]="query()"
                            (input)="query.set(($any($event.target).value ?? '').toString())"
                    />
                </div>
            </div>
        </div>

        <!-- Difficulty chips -->
        <div class="rounded-2xl bg-slate-50 dark:bg-white/5 p-3 h-fit">
            <div class="flex flex-wrap gap-2">
                <button
                        type="button"
                        (click)="setDifficulty('All')"
                        class="rounded-full px-3 py-2 text-sm transition dark:text-white dark:hover:text-black hover:bg-white focus:outline-none focus:ring-2 focus:ring-slate-200"
                        [ngClass]="{ 'bg-white dark:text-black!': difficulty() === 'All' }"
                        [class.font-medium]="difficulty() === 'All'">
                    All
                </button>

                <button
                        type="button"
                        (click)="setDifficulty('Beginner')"
                        class="rounded-full px-3 py-2 text-sm transition dark:text-white dark:hover:text-black hover:bg-white focus:outline-none focus:ring-2 focus:ring-slate-200"
                        [ngClass]="{ 'bg-white dark:text-black!': difficulty() === 'Beginner' }"
                        [class.font-medium]="difficulty() === 'Beginner'">
                    Beginner <span class="ml-1 text-xs text-slate-500">{{ stats().counts.Beginner }}</span>
                </button>

                <button
                        type="button"
                        (click)="setDifficulty('Intermediate')"
                        class="rounded-full px-3 py-2 text-sm transition dark:text-white dark:hover:text-black hover:bg-white focus:outline-none focus:ring-2 focus:ring-slate-200"
                        [ngClass]="{ 'bg-white dark:text-black!': difficulty() === 'Intermediate' }"
                        [class.font-medium]="difficulty() === 'Intermediate'">
                    Intermediate <span class="ml-1 text-xs text-slate-500">{{ stats().counts.Intermediate }}</span>
                </button>

                <button
                        type="button"
                        (click)="setDifficulty('Advanced')"
                        class="rounded-full px-3 py-2 text-sm transition dark:text-white dark:hover:text-black hover:bg-white focus:outline-none focus:ring-2 focus:ring-slate-200"
                        [ngClass]="{ 'bg-white dark:text-black!': difficulty() === 'Advanced' }"
                        [class.font-medium]="difficulty() === 'Advanced'">
                    Advanced <span class="ml-1 text-xs text-slate-500">{{ stats().counts.Advanced }}</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="mt-8">
        @if (manifest()?.length === 0) {
            <div class="rounded-2xl bg-slate-50 p-6 text-sm text-slate-600">
                Loading tutorials…
            </div>
        } @else {
            @if (filteredItems().length === 0) {
                <div class="rounded-2xl bg-slate-50 dark:bg-white/5 p-6">
                    <div class="text-sm font-medium text-slate-900 dark:text-white">No matches</div>
                    <div class="mt-1 text-sm text-slate-600 dark:text-white/50">
                        Try a different search term or clear the difficulty filter.
                    </div>
                </div>
            } @else {
                <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
                    @for (item of filteredItems(); track item.id) {
                        <a
                                class="group rounded-2xl bg-white dark:bg-white/5 shadow-sm ring-1 ring-slate-100 dark:ring-white/10 p-5 transition
                       hover:shadow-md hover:ring-slate-200 dark:hover:ring-white/20"
                                [routerLink]="['/tutorials', item.id]">

                            <div class="flex items-start justify-between gap-3">
                                <div class="min-w-0">
                                    <div class="text-base font-semibold text-slate-900 dark:text-white truncate">
                                        {{ item.title }}
                                    </div>
                                    <div class="mt-1 text-sm text-slate-600 dark:text-white/50 line-clamp-2">
                                        {{ item.subtitle }}
                                    </div>
                                </div>

                                <div class="flex flex-col items-end gap-2">
                                    @if (item.difficulty) {
                                        <span class="shrink-0 rounded-full bg-slate-50 px-3 py-1 text-xs text-slate-600 dark:bg-white/5 dark:text-white">
                                          {{ item.difficulty }}
                                        </span>
                                    }

                                    @if (item.etaMinutes) {
                                        <div class="text-xs text-slate-500 dark:text-white/50">
                                            ~{{ item.etaMinutes }} min
                                        </div>
                                    }
                                </div>
                            </div>

                            @if (item?.tags?.length) {
                                <div class="mt-4 flex items-center justify-between gap-3">
                                    <div class="flex flex-wrap gap-1.5">
                                        @for (tag of item.tags; track tag) {
                                            <span class="rounded-full bg-slate-100 px-2 py-0.5 text-[11px] text-slate-600 dark:bg-white/5 dark:text-white">
                                                  {{ tag }}
                                                </span>
                                        }
                                    </div>
                                </div>
                            }

                            <div class="mt-4 text-sm font-medium text-slate-900 dark:text-white group-hover:underline flex items-center gap-1">
                                <span>Open tutorial</span>
                                <ng-icon name="tablerChevronRight"></ng-icon>
                            </div>
                        </a>
                    }
                </div>
            }
        }
    </div>
</div>